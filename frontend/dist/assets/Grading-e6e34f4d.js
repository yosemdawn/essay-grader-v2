import{I as L,d as se,r as o,c as S,b as a,e as t,w as l,l as I,t as m,g as te,i as n,o as c,m as A,J as D,j as r,y as k,C as i}from"./index-bd42a384.js";import{_ as le}from"./_plugin-vue_export-helper-c27b6911.js";function ae(w){return L.post(`/grading/process-batch/${w}`)}function oe(w){return L.get(`/grading/status/${w}`)}const ne={class:"grading"},ue={class:"step-actions"},re={class:"el-upload__tip"},ie={class:"step-actions"},de={class:"progress-section"},ce={class:"progress-info"},pe={key:0},ve={key:0,class:"results-section"},_e={class:"step-actions"},ge=se({__name:"Grading",setup(w){const q=te(),u=o(0),p=o(!1),B=o(!1),v=o([]),d=o([]),h=o(""),P=o(""),_=o("pending"),$=o(0),E=o(""),T=o(0),V=o(0),b=o([]);let C=null;const z=s=>{v.value=[s]},J=(s,e)=>{d.value=e},F=async()=>{if(v.value.length===0){i.warning("è¯·å…ˆé€‰æ‹©ä½œæ–‡è¦æ±‚å›¾ç‰‡");return}p.value=!0;try{const s=v.value[0].raw,e=await F(s);h.value=e.session_id,i.success("ä½œæ–‡è¦æ±‚ä¸Šä¼ æˆåŠŸ"),u.value=1}catch(s){i.error(s.message||"ä¸Šä¼ å¤±è´¥")}finally{p.value=!1}},G=async()=>{if(d.value.length===0){i.warning("è¯·å…ˆé€‰æ‹©å­¦ç”Ÿä½œæ–‡å›¾ç‰‡");return}p.value=!0;try{const s=d.value.map(g=>g.raw),e=await G(h.value,s);i.success(`æˆåŠŸä¸Šä¼  ${e.uploaded_count} ä»½ä½œæ–‡`),u.value=2}catch(s){i.error(s.message||"ä¸Šä¼ å¤±è´¥")}finally{p.value=!1}},H=async()=>{B.value=!0;try{const s=await ae(h.value);P.value=s.task_id,i.success("æ‰¹é˜…ä»»åŠ¡å·²å¯åŠ¨"),u.value=3,K()}catch(s){i.error(s.message||"å¯åŠ¨æ‰¹é˜…å¤±è´¥")}finally{B.value=!1}},K=()=>{C=window.setInterval(async()=>{try{const s=await oe(P.value);_.value=s.status,E.value=s.message,T.value=s.current,V.value=s.total,$.value=s.progress,s.results&&(b.value=s.results),(s.status==="completed"||s.status==="failed")&&(M(),s.status==="completed"?i.success("æ‰¹é˜…å®Œæˆï¼"):i.error("æ‰¹é˜…å¤±è´¥"))}catch(s){console.error("è½®è¯¢ä»»åŠ¡çŠ¶æ€å¤±è´¥:",s)}},2e3)},M=()=>{C&&(clearInterval(C),C=null)},O=()=>{q.push("/admin/records")},Q=()=>{M(),u.value=0,v.value=[],d.value=[],h.value="",P.value="",_.value="pending",$.value=0,E.value="",b.value=[]};return(s,e)=>{const g=n("el-step"),U=n("el-steps"),y=n("el-card"),R=n("el-icon"),j=n("el-upload"),f=n("el-button"),W=n("el-result"),X=n("el-progress"),Y=n("el-divider"),x=n("el-table-column"),Z=n("el-tag"),ee=n("el-table");return c(),S("div",ne,[e[15]||(e[15]=a("h2",{class:"page-title"},"âœï¸ æ‰¹é˜…ä½œæ–‡",-1)),t(y,{class:"steps-card",shadow:"hover"},{default:l(()=>[t(U,{active:u.value,"align-center":"","finish-status":"success"},{default:l(()=>[t(g,{title:"ä¸Šä¼ ä½œæ–‡è¦æ±‚",description:"ä¸Šä¼ ä½œæ–‡é¢˜ç›®å›¾ç‰‡"}),t(g,{title:"ä¸Šä¼ å­¦ç”Ÿä½œæ–‡",description:"æ‰¹é‡ä¸Šä¼ å­¦ç”Ÿä½œæ–‡å›¾ç‰‡"}),t(g,{title:"å¼€å§‹æ‰¹é˜…",description:"AIè‡ªåŠ¨æ‰¹é˜…å¹¶ç”Ÿæˆè®°å½•"}),t(g,{title:"æŸ¥çœ‹ç»“æœ",description:"æŸ¥çœ‹æ‰¹é˜…ç»“æœ"})]),_:1},8,["active"])]),_:1}),u.value===0?(c(),I(y,{key:0,class:"step-card",shadow:"hover"},{header:l(()=>[...e[1]||(e[1]=[a("span",null,"ğŸ“„ æ­¥éª¤1: ä¸Šä¼ ä½œæ–‡è¦æ±‚å›¾ç‰‡",-1)])]),default:l(()=>[t(j,{class:"upload-demo",drag:"","auto-upload":!1,limit:1,accept:"image/*","on-change":z,"file-list":v.value},{tip:l(()=>[...e[2]||(e[2]=[a("div",{class:"el-upload__tip"},"åªèƒ½ä¸Šä¼ jpg/pngæ–‡ä»¶ï¼Œä¸”ä¸è¶…è¿‡10MB",-1)])]),default:l(()=>[t(R,{class:"el-icon--upload"},{default:l(()=>[t(A(D))]),_:1}),e[3]||(e[3]=a("div",{class:"el-upload__text"},[r(" å°†ä½œæ–‡è¦æ±‚å›¾ç‰‡æ‹–åˆ°æ­¤å¤„ï¼Œæˆ–"),a("em",null,"ç‚¹å‡»ä¸Šä¼ ")],-1))]),_:1},8,["file-list"]),a("div",ue,[t(f,{type:"primary",loading:p.value,onClick:F,disabled:v.value.length===0},{default:l(()=>[...e[4]||(e[4]=[r(" ä¸‹ä¸€æ­¥ ",-1)])]),_:1},8,["loading","disabled"])])]),_:1})):m("",!0),u.value===1?(c(),I(y,{key:1,class:"step-card",shadow:"hover"},{header:l(()=>[...e[5]||(e[5]=[a("span",null,"ğŸ“š æ­¥éª¤2: æ‰¹é‡ä¸Šä¼ å­¦ç”Ÿä½œæ–‡å›¾ç‰‡ (æœ€å¤š50å¼ )",-1)])]),default:l(()=>[t(j,{class:"upload-demo",drag:"",multiple:"","auto-upload":!1,limit:50,accept:"image/*","on-change":J,"file-list":d.value},{tip:l(()=>[a("div",re," å¯ä»¥ä¸€æ¬¡é€‰æ‹©å¤šä¸ªæ–‡ä»¶ï¼Œæœ€å¤š50å¼ ã€‚å·²é€‰æ‹©: "+k(d.value.length)+" å¼  ",1)]),default:l(()=>[t(R,{class:"el-icon--upload"},{default:l(()=>[t(A(D))]),_:1}),e[6]||(e[6]=a("div",{class:"el-upload__text"},[r(" å°†å­¦ç”Ÿä½œæ–‡å›¾ç‰‡æ‹–åˆ°æ­¤å¤„ï¼Œæˆ–"),a("em",null,"ç‚¹å‡»ä¸Šä¼ ")],-1))]),_:1},8,["file-list"]),a("div",ie,[t(f,{onClick:e[0]||(e[0]=N=>u.value=0)},{default:l(()=>[...e[7]||(e[7]=[r("ä¸Šä¸€æ­¥",-1)])]),_:1}),t(f,{type:"primary",loading:p.value,onClick:G,disabled:d.value.length===0},{default:l(()=>[...e[8]||(e[8]=[r(" ä¸‹ä¸€æ­¥ ",-1)])]),_:1},8,["loading","disabled"])])]),_:1})):m("",!0),u.value===2?(c(),I(y,{key:2,class:"step-card",shadow:"hover"},{header:l(()=>[...e[9]||(e[9]=[a("span",null,"ğŸš€ æ­¥éª¤3: å¼€å§‹æ‰¹é˜…",-1)])]),default:l(()=>[t(W,{icon:"success",title:"æ–‡ä»¶ä¸Šä¼ å®Œæˆ","sub-title":`å·²ä¸Šä¼  ${d.value.length} ä»½å­¦ç”Ÿä½œæ–‡ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹AIæ‰¹é˜…`},{extra:l(()=>[t(f,{type:"primary",size:"large",loading:B.value,onClick:H},{default:l(()=>[...e[10]||(e[10]=[r(" å¼€å§‹æ‰¹é˜… ",-1)])]),_:1},8,["loading"])]),_:1},8,["sub-title"])]),_:1})):m("",!0),u.value===3?(c(),I(y,{key:3,class:"step-card",shadow:"hover"},{header:l(()=>[...e[11]||(e[11]=[a("span",null,"ğŸ“Š æ­¥éª¤4: æ‰¹é˜…è¿›åº¦",-1)])]),default:l(()=>[a("div",de,[t(X,{percentage:$.value,status:_.value==="completed"?"success":_.value==="failed"?"exception":void 0},null,8,["percentage","status"]),a("div",ce,[a("p",null,k(E.value),1),_.value==="processing"?(c(),S("p",pe," è¿›åº¦: "+k(T.value)+" / "+k(V.value),1)):m("",!0)]),_.value==="completed"&&b.value.length>0?(c(),S("div",ve,[t(Y,null,{default:l(()=>[...e[12]||(e[12]=[r("æ‰¹é˜…ç»“æœ",-1)])]),_:1}),t(ee,{data:b.value,stripe:""},{default:l(()=>[t(x,{prop:"student_name",label:"å­¦ç”Ÿå§“å",width:"150"}),t(x,{prop:"status",label:"çŠ¶æ€",width:"100"},{default:l(({row:N})=>[t(Z,{type:N.status==="success"?"success":"danger"},{default:l(()=>[r(k(N.status==="success"?"æˆåŠŸ":"å¤±è´¥"),1)]),_:2},1032,["type"])]),_:1}),t(x,{prop:"record_id",label:"è®°å½•ID",width:"100"}),t(x,{prop:"error",label:"é”™è¯¯ä¿¡æ¯","show-overflow-tooltip":""})]),_:1},8,["data"])])):m("",!0)]),a("div",_e,[t(f,{type:"primary",onClick:O},{default:l(()=>[...e[13]||(e[13]=[r("æŸ¥çœ‹æ‰¹é˜…è®°å½•",-1)])]),_:1}),t(f,{onClick:Q},{default:l(()=>[...e[14]||(e[14]=[r("é‡æ–°æ‰¹é˜…",-1)])]),_:1})])]),_:1})):m("",!0)])}}});const ye=le(ge,[["__scopeId","data-v-d56afccf"]]);export{ye as default};
