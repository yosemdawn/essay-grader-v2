import{d as Z,r as u,k as ee,D as le,c as L,b as ae,e as l,w as a,g as te,C as i,i as n,G as oe,o as U,j as r,f as se,m as ne,K as ue,F as re,L as de,H as ie,l as R,y as pe,E as me}from"./index-bd42a384.js";import{g as ve,b as fe,r as ce,d as _e}from"./users-c7770b4a.js";import{_ as ge}from"./_plugin-vue_export-helper-c27b6911.js";const we={class:"students"},ye=Z({__name:"Students",setup(be){const j=te(),S=u(!1),z=u(!1),D=u(!1),_=u([]),$=u(0),B=u(1),V=u(20),g=u(""),x=u(""),C=u(void 0),w=u(!1),y=u(!1),p=u({default_password:"123456",studentsText:""}),m=u({resetType:"all",new_password:""}),M=ee(()=>{const o=new Set(_.value.map(e=>e.class_name).filter(Boolean));return Array.from(o)}),d=async()=>{S.value=!0;try{const o={role:"student",skip:(B.value-1)*V.value,limit:V.value};x.value&&(o.class_name=x.value),C.value!==void 0&&(o.is_active=C.value);const e=await ve(o);g.value?(_.value=e.users.filter(s=>s.username.includes(g.value)||s.email&&s.email.includes(g.value)),$.value=_.value.length):(_.value=e.users,$.value=e.total)}catch(o){i.error(o.message||"åŠ è½½å­¦ç”Ÿåˆ—è¡¨å¤±è´¥")}finally{S.value=!1}},N=()=>{p.value={default_password:"123456",studentsText:""},w.value=!0},A=async()=>{if(!p.value.studentsText.trim()){i.warning("è¯·è¾“å…¥å­¦ç”Ÿä¿¡æ¯");return}z.value=!0;try{const o=p.value.studentsText.trim().split(`
`),e=[];for(const f of o){const v=f.split(",").map(k=>k.trim());v.length>=1&&e.push({username:v[0],email:v[1]||void 0,class_name:v[2]||void 0})}const s=await fe({students:e,default_password:p.value.default_password});i.success(`æˆåŠŸå¯¼å…¥ ${s.created_count} ä¸ªå­¦ç”Ÿ`),s.failed_count>0&&i.warning(`å¤±è´¥ ${s.failed_count} ä¸ª`),w.value=!1,d()}catch(o){i.error(o.message||"å¯¼å…¥å¤±è´¥")}finally{z.value=!1}},G=()=>{m.value={resetType:"all",new_password:""},y.value=!0},H=async()=>{if(!m.value.new_password){i.warning("è¯·è¾“å…¥æ–°å¯†ç ");return}D.value=!0;try{const o={new_password:m.value.new_password};m.value.resetType==="all"&&(o.reset_all_students=!0);const e=await ce(o);i.success(`æˆåŠŸé‡ç½® ${e.affected_count} ä¸ªç”¨æˆ·çš„å¯†ç `),y.value=!1}catch(o){i.error(o.message||"é‡ç½®å¯†ç å¤±è´¥")}finally{D.value=!1}},h=o=>{j.push(`/admin/records?username=${o}`)},q=async o=>{try{await me.confirm(`ç¡®å®šè¦åˆ é™¤å­¦ç”Ÿ ${o.username} å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`,"è­¦å‘Š",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await _e(o.id),i.success("åˆ é™¤æˆåŠŸ"),d()}catch(e){e!=="cancel"&&i.error(e.message||"åˆ é™¤å¤±è´¥")}};return le(()=>{d()}),(o,e)=>{const s=n("el-button"),f=n("el-col"),v=n("el-input"),k=n("el-row"),b=n("el-option"),P=n("el-select"),I=n("el-card"),c=n("el-table-column"),J=n("el-tag"),O=n("el-table"),Q=n("el-pagination"),T=n("el-form-item"),E=n("el-form"),F=n("el-dialog"),K=n("el-radio"),W=n("el-radio-group"),X=oe("loading");return U(),L("div",we,[e[23]||(e[23]=ae("h2",{class:"page-title"},"ğŸ‘¨â€ğŸ“ å­¦ç”Ÿç®¡ç†",-1)),l(I,{class:"toolbar-card",shadow:"hover"},{default:a(()=>[l(k,{gutter:20},{default:a(()=>[l(f,{span:12},{default:a(()=>[l(s,{type:"primary",onClick:N},{default:a(()=>[...e[13]||(e[13]=[r(" æ‰¹é‡å¯¼å…¥å­¦ç”Ÿ ",-1)])]),_:1}),l(s,{type:"warning",onClick:G},{default:a(()=>[...e[14]||(e[14]=[r(" é‡ç½®å¯†ç  ",-1)])]),_:1})]),_:1}),l(f,{span:12},{default:a(()=>[l(v,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),placeholder:"æœç´¢å­¦ç”Ÿå§“åæˆ–ç”¨æˆ·å",clearable:"",onClear:d,onKeyup:se(d,["enter"])},{append:a(()=>[l(s,{icon:ne(ue),onClick:d},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(k,{gutter:20,style:{"margin-top":"15px"}},{default:a(()=>[l(f,{span:6},{default:a(()=>[l(P,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=t=>x.value=t),placeholder:"ç­›é€‰ç­çº§",clearable:"",onChange:d},{default:a(()=>[l(b,{label:"å…¨éƒ¨ç­çº§",value:""}),(U(!0),L(re,null,de(M.value,t=>(U(),R(b,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(f,{span:6},{default:a(()=>[l(P,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=t=>C.value=t),placeholder:"ç­›é€‰çŠ¶æ€",clearable:"",onChange:d},{default:a(()=>[l(b,{label:"å…¨éƒ¨çŠ¶æ€",value:void 0}),l(b,{label:"æ´»è·ƒ",value:!0}),l(b,{label:"ç¦ç”¨",value:!1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(I,{class:"table-card",shadow:"hover"},{default:a(()=>[ie((U(),R(O,{data:_.value,stripe:"",style:{width:"100%"}},{default:a(()=>[l(c,{prop:"id",label:"ID",width:"80"}),l(c,{prop:"username",label:"ç”¨æˆ·å",width:"150"}),l(c,{prop:"email",label:"é‚®ç®±",width:"200"}),l(c,{prop:"class_name",label:"ç­çº§",width:"120"}),l(c,{prop:"is_active",label:"çŠ¶æ€",width:"100"},{default:a(({row:t})=>[l(J,{type:t.is_active?"success":"danger"},{default:a(()=>[r(pe(t.is_active?"æ´»è·ƒ":"ç¦ç”¨"),1)]),_:2},1032,["type"])]),_:1}),l(c,{label:"æ“ä½œ",width:"200"},{default:a(({row:t})=>[l(s,{type:"primary",link:"",onClick:Y=>h(t.username)},{default:a(()=>[...e[15]||(e[15]=[r(" æŸ¥çœ‹è®°å½• ",-1)])]),_:1},8,["onClick"]),l(s,{type:"danger",link:"",onClick:Y=>q(t)},{default:a(()=>[...e[16]||(e[16]=[r(" åˆ é™¤ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,S.value]]),l(Q,{"current-page":B.value,"onUpdate:currentPage":e[3]||(e[3]=t=>B.value=t),"page-size":V.value,"onUpdate:pageSize":e[4]||(e[4]=t=>V.value=t),total:$.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:d,onCurrentChange:d,style:{"margin-top":"20px","justify-content":"center"}},null,8,["current-page","page-size","total"])]),_:1}),l(F,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=t=>w.value=t),title:"æ‰¹é‡å¯¼å…¥å­¦ç”Ÿ",width:"600px"},{footer:a(()=>[l(s,{onClick:e[7]||(e[7]=t=>w.value=!1)},{default:a(()=>[...e[17]||(e[17]=[r("å–æ¶ˆ",-1)])]),_:1}),l(s,{type:"primary",loading:z.value,onClick:A},{default:a(()=>[...e[18]||(e[18]=[r(" å¯¼å…¥ ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(E,{model:p.value,"label-width":"120px"},{default:a(()=>[l(T,{label:"é»˜è®¤å¯†ç "},{default:a(()=>[l(v,{modelValue:p.value.default_password,"onUpdate:modelValue":e[5]||(e[5]=t=>p.value.default_password=t),placeholder:"é»˜è®¤å¯†ç ï¼Œå¦‚: 123456"},null,8,["modelValue"])]),_:1}),l(T,{label:"å­¦ç”Ÿä¿¡æ¯"},{default:a(()=>[l(v,{modelValue:p.value.studentsText,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value.studentsText=t),type:"textarea",rows:10,placeholder:`æ¯è¡Œä¸€ä¸ªå­¦ç”Ÿï¼Œæ ¼å¼: ç”¨æˆ·å,é‚®ç®±,ç­çº§
ä¾‹å¦‚:
zhangsan,zhangsan@example.com,ä¸€ç­
lisi,lisi@example.com,äºŒç­`},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(F,{modelValue:y.value,"onUpdate:modelValue":e[12]||(e[12]=t=>y.value=t),title:"é‡ç½®å¯†ç ",width:"500px"},{footer:a(()=>[l(s,{onClick:e[11]||(e[11]=t=>y.value=!1)},{default:a(()=>[...e[21]||(e[21]=[r("å–æ¶ˆ",-1)])]),_:1}),l(s,{type:"primary",loading:D.value,onClick:H},{default:a(()=>[...e[22]||(e[22]=[r(" ç¡®å®š ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(E,{model:m.value,"label-width":"120px"},{default:a(()=>[l(T,{label:"é‡ç½®èŒƒå›´"},{default:a(()=>[l(W,{modelValue:m.value.resetType,"onUpdate:modelValue":e[9]||(e[9]=t=>m.value.resetType=t)},{default:a(()=>[l(K,{label:"all"},{default:a(()=>[...e[19]||(e[19]=[r("æ‰€æœ‰å­¦ç”Ÿ",-1)])]),_:1}),l(K,{label:"selected"},{default:a(()=>[...e[20]||(e[20]=[r("é€‰ä¸­çš„å­¦ç”Ÿ",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(T,{label:"æ–°å¯†ç "},{default:a(()=>[l(v,{modelValue:m.value.new_password,"onUpdate:modelValue":e[10]||(e[10]=t=>m.value.new_password=t),placeholder:"è¾“å…¥æ–°å¯†ç "},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const ke=ge(ye,[["__scopeId","data-v-7b6ccada"]]);export{ke as default};
